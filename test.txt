

#!/bin/bash
#
# Chatty AI Startup Script
# Shows black screen with logo, video, loading animation, then main interface
#

# Configuration
VIDEO_PATH="/home/nickspi5/Chatty_AI/Chatty_AI_starting.mp4"
LOADING_PAGE="/home/nickspi5/Chatty_AI/templates/chatty_loading.html"
BLACK_PAGE="/home/nickspi5/Chatty_AI/templates/black_with_logo.html"
CHATTY_URL="http://localhost:5000"
LOG_FILE="/home/nickspi5/Chatty_AI/logs/startup.log"
USER="nickspi5"

# Create log directory if it doesn't exist
mkdir -p /home/nickspi5/Chatty_AI/logs

# Function to log messages
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# Start logging
log_message "========================================="
log_message "Chatty AI Startup Sequence Initiated"
log_message "========================================="

# Set display
export DISPLAY=:0
export XAUTHORITY=/home/nickspi5/.Xauthority

# Wait for desktop to be fully loaded
log_message "Waiting for desktop to load..."
sleep 20  # Increased to ensure desktop is fully ready

# Kill any desktop manager error dialogs
log_message "Clearing any error dialogs..."
pkill -f "Desktop manager" 2>/dev/null
wmctrl -F -c "Desktop manager is not active" 2>/dev/null || true
xdotool search --name "Desktop manager" windowclose 2>/dev/null || true

# Ensure no browsers are running
pkill -f chromium 2>/dev/null
sleep 1

# Display black screen with logo in fullscreen (covers desktop immediately)
log_message "Displaying black screen with logo..."
chromium-browser \
    --kiosk \
    --noerrdialogs \
    --disable-infobars \
    --start-fullscreen \
    --disable-session-crashed-bubble \
    --disable-features=TranslateUI \
    --check-for-update-interval=31536000 \
    --disable-component-update \
    --app="file://$BLACK_PAGE" 2>/dev/null &

BLACK_PID=$!
log_message "Black screen PID: $BLACK_PID"

# Give black screen time to cover desktop
sleep 3

# Play video
if [ -f "$VIDEO_PATH" ]; then
    log_message "Playing startup video..."
    
    # Play video in fullscreen (on top of black screen)
    cvlc --fullscreen --play-and-exit --video-on-top "$VIDEO_PATH" 2>/dev/null || log_message "Video playback ended"
    
    log_message "Video sequence complete"
else
    log_message "Warning: Video file not found at $VIDEO_PATH"
fi

# Kill the black screen browser
kill $BLACK_PID 2>/dev/null
pkill -f "black_with_logo" 2>/dev/null

# Small delay to prevent desktop flash
sleep 0.5

# Launch loading screen immediately
log_message "Launching loading screen..."

# Launch loading screen in fullscreen
chromium-browser \
    --kiosk \
    --noerrdialogs \
    --disable-infobars \
    --start-fullscreen \
    --disable-translate \
    --disable-features=TranslateUI \
    --disable-component-update \
    --disable-session-crashed-bubble \
    --check-for-update-interval=31536000 \
    --app="file://$LOADING_PAGE" 2>/dev/null &

CHROMIUM_PID=$!
log_message "Loading screen launched with PID: $CHROMIUM_PID"

# The loading page will automatically redirect to localhost:5000 after 70 seconds
log_message "System loading sequence in progress..."
log_message "========================================="

# Keep script running
wait $CHROMIUM_PID



3. Install Additional Tools

sudo apt install xdotool

4. Setup Instructions

Save the black screen with logo:

nano /home/nickspi5/Chatty_AI/templates/black_with_logo.html

# Copy the black_with_logo.html content and save

Update the startup script:

nano /home/nickspi5/Chatty_AI/chatty_ai_startup_final.sh

# Replace entire content with the new script

chmod +x /home/nickspi5/Chatty_AI/chatty_ai_startup_final.sh

Fix the autostart filename (you had .service, should be .desktop):

# Remove the wrong file
rm /home/nickspi5/.config/autostart/chatty-ai-launcher.service

# Create the correct file
nano /home/nickspi5/.config/autostart/chatty-ai-launcher.desktop

Content should be:

[Desktop Entry]
Type=Application
Name=Chatty AI Auto Launcher
Comment=Automatically launch Chatty AI on boot
Exec=/bin/bash /home/nickspi5/Chatty_AI/chatty_ai_startup_final.sh
Hidden=false
NoDisplay=false
X-GNOME-Autostart-enabled=true
Terminal=false
StartupNotify=false

5. Disable Desktop Manager Warning

To prevent the "Desktop manager is not active" error:

# Edit PCManFM config
nano /home/nickspi5/.config/pcmanfm/LXDE-pi/desktop-items-0.conf

Add or modify:
ini[*]
desktop_bg=#000000
desktop_shadow=#000000
desktop_fg=#ffffff
show_documents=0
show_trash=0
show_mounts=0
Key Improvements

Logo on black screen - Your logo appears with a subtle glow animation
Better error dialog handling - Uses multiple methods to close the dialog
Smooth transitions - Video plays on top of black screen, then transitions directly to loading
No desktop flashing - Careful timing and --app flag for borderless windows
Extended wait time - 20 seconds initial wait ensures desktop is fully loaded

After these changes, the sequence should be:

Black screen with glowing Chatty AI logo (no desktop visible)
Startup video plays
Loading animation displays
Main interface opens

The desktop remains functional but hidden during the entire startup sequence.





