


I see the issue now. The function currently returns True/False, but we're doing a redundant transcription after. Let me modify the function to return the transcript directly so we don't need to transcribe twice.

Step 1: Modify record_with_streaming_transcription to Return the Transcript
bashnano /home/nickspi5/Chatty_AI/chatty_ai.py
Find the end of the record_with_streaming_transcription function (around line 950-960) and look for:
python                self.emit_log(f"Audio saved: {len(full_audio)/16000:.1f}s", 'debug')
                return True
                
        except Exception as e:
            self.emit_log(f"Streaming recording error: {e}", 'error')
            import traceback
            traceback.print_exc()
            return False
Change it to return the transcript instead:
python                self.emit_log(f"Audio saved: {len(full_audio)/16000:.1f}s", 'debug')
                
                # Return the last partial transcript if we have one, otherwise transcribe now
                if full_transcript and len(full_transcript.strip()) > 2:
                    self.emit_log(f"[STREAMING STT] Using cached transcript: '{full_transcript}'", 'info')
                    return full_transcript
                else:
                    # Transcribe the full audio as fallback
                    final_transcript = self.transcribe_audio(WAV_FILENAME)
                    return final_transcript if final_transcript else ""
                
        except Exception as e:
            self.emit_log(f"Streaming recording error: {e}", 'error')
            import traceback
            traceback.print_exc()
            return ""

Step 2: Update the Caller in listen_for_wake_word
Now find the section in listen_for_wake_word where we call the function (around line 1135-1160):
bashsed -n '1130,1170p' /home/nickspi5/Chatty_AI/chatty_ai.py
Then change this:
python                            # Record full request with streaming transcription
                            self.emit_log("Please speak your request...", 'info')
                            if self.record_with_streaming_transcription():
                                # Final transcription on saved audio (more accurate)
                                user_text = self.transcribe_audio(WAV_FILENAME)
                                if user_text and len(user_text.strip()) > 2:
To this:
python                            # Record full request with streaming transcription
                            self.emit_log("Please speak your request...", 'info')
                            user_text = self.record_with_streaming_transcription()
                            if user_text and len(user_text.strip()) > 2:
This removes the redundant self.transcribe_audio(WAV_FILENAME) call since the function now returns the transcript directly.
Save and exit.

Step 3: Test for Syntax Errors
bashcd /home/nickspi5/Chatty_AI
source chatty-venv/bin/activate
python3 -m py_compile chatty_ai.py && echo "No syntax errors!"

Step 4: Restart and Test
bashsudo systemctl restart chatty-ai.service
Test with a question. The response should now be faster since we're not transcribing twice.
bashjournalctl -u chatty-ai.service -f
Look for [STREAMING STT] Using cached transcript: in the logs - this confirms we're reusing the partial transcript instead of transcribing again.



