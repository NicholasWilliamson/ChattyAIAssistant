

The startup sequence is working well except for two issues: the black screen not showing and wake word detection problems. Let's fix both:

1. Fix Black Screen Display

The black screen needs to wait for the desktop to be ready. Update your startup script:

nano /home/nickspi5/Chatty_AI/chatty_ai_startup_final.sh

Change the sleep time and add a desktop wait:

# Wait for desktop to be fully loaded
log_message "Waiting for desktop to load..."
# Wait for desktop environment
while ! pgrep -x "pcmanfm" > /dev/null; do
    sleep 1
done
sleep 5  # Additional wait for full initialization

2. Fix Wake Word Detection

The wake word issue after reboot is likely the audio device initialization. In your chatty_ai.py, update the record_wake_word_check method:

def record_wake_word_check(self):
    """Record short audio clip for wake word detection"""
    try:
        if not self.audio_recording_lock.acquire(blocking=False):
            return False
        
        try:
            # Simple recording without device detection
            audio_data = sd.rec(int(5 * 16000), 
                               samplerate=16000, 
                               channels=1, 
                               dtype='float32',
                               blocking=True)  # Use blocking mode
            
            # Check if audio contains sound
            rms = np.sqrt(np.mean(audio_data**2))
            wake_word_threshold = SILENCE_THRESHOLD * 1.2
            
            if rms > wake_word_threshold:
                sf.write(WAKE_WORD_AUDIO, audio_data, 16000)
                return True
            return False
                
        finally:
            self.audio_recording_lock.release()
            
    except Exception as e:
        self.emit_log(f"Wake word recording error: {e}", 'error')
        # Try to reinitialize audio on error
        sd.default.reset()
        return False

3. Test Wake Word Manually

Create a test script to debug wake word:

cat > /home/nickspi5/Chatty_AI/test_wake.py << 'EOF'
import sounddevice as sd
import numpy as np

print("Testing audio recording...")
try:
    print("Available devices:")
    print(sd.query_devices())
    
    print("\nRecording 3 seconds...")
    audio = sd.rec(int(3 * 16000), samplerate=16000, channels=1, dtype='float32')
    sd.wait()
    
    rms = np.sqrt(np.mean(audio**2))
    print(f"Audio RMS: {rms}")
    
    if rms > 0.01:
        print("Audio recording works!")
    else:
        print("No audio detected - check microphone")
        
except Exception as e:
    print(f"Error: {e}")
EOF

python3 test_wake.py

The system is 99% complete. These minor fixes should resolve the remaining issues.
