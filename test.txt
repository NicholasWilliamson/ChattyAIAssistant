

# Fix the missing libcamerify library
echo "=== Fixing libcamerify ==="

# Install the missing v4l2-compat library
sudo apt update
sudo apt install -y libcamera-v4l2

# Find where the v4l2-compat.so file is located
find /usr -name "v4l2-compat.so" 2>/dev/null
find /usr -name "*v4l2*compat*" 2>/dev/null

# Test libcamerify again after installing the library
echo "=== Testing libcamerify after fix ==="
libcamerify python3 -c "
import cv2
cap = cv2.VideoCapture(0)  # Try index 0 first
if cap.isOpened():
    ret, frame = cap.read()
    if ret and frame is not None:
        print(f'✅ SUCCESS with libcamerify! Frame: {frame.shape}')
        cv2.imwrite('libcamerify_success.jpg', frame)
    else:
        print('❌ libcamerify: No frames from index 0')
    cap.release()
else:
    print('❌ libcamerify: Cannot open camera index 0')
"

# Also test with direct cam utility approach for OpenCV
echo "=== Testing direct cam utility approach ==="
cam --camera=1 --capture=1 --file=cam_test.bin --stream role=video,width=640,height=480,format=YUV420

# Check if we can convert this to something OpenCV can use
if [ -f "cam_test.bin" ]; then
    echo "✅ cam utility can capture frames"
    ls -la cam_test.bin
else
    echo "❌ cam utility failed"
fi









