I see two issues:

Port 5000 is already in use - There's another instance running
The camera fix was partially applied but we need to complete it

Let's fix both issues:
First, kill the existing process:
bash# Find and kill any existing chatty processes
sudo pkill -f "python.*chatty"
sudo lsof -ti:5000 | xargs sudo kill -9

# Wait a moment for cleanup
sleep 3
Second, let's complete the camera monitoring loop fix. The issue is that even though we fixed the race condition, the camera monitoring loop still has the old logic. Let's check what we have:
bashgrep -n -A 15 "def camera_monitoring_loop" chatty_ai.py
The problem is likely that the camera monitoring loop is still exiting immediately. Let's apply the complete fix:
bash# Let's see the current camera monitoring loop
grep -n -A 20 -B 5 "while self.system_running:" chatty_ai.py
Now let's fix the monitoring loop properly:
bash# First, let's see the exact structure
sed -n '1350,1400p' chatty_ai.py
Based on the earlier grep output, the issue is in the camera_monitoring_loop. Let's fix it by ensuring it also checks for monitor_running:
bash# Fix the while loop condition in camera_monitoring_loop
sed -i 's/while self.system_running:/while self.system_running and self.monitor_running:/' chatty_ai.py

# Also ensure monitor_running is set early
sed -i '/self.system_running = True/a\
                    self.monitor_running = True' chatty_ai.py
Let's verify the changes:
bashgrep -n -A 5 -B 5 "while self.system_running" chatty_ai.py
grep -n -A 3 -B 3 "monitor_running = True" chatty_ai.py
Now let's also add debugging to see what's happening:
bash# Add debug logging to camera monitoring loop
sed -i '/def camera_monitoring_loop/a\
        """Main camera monitoring loop for web interface"""\
        logger.info("Camera monitoring thread started - DEBUG INFO")\
        logger.info(f"system_running: {self.system_running}, monitor_running: {self.monitor_running}")\
        self.emit_log("Camera monitoring thread started", '"'"'success'"'"')' chatty_ai.py
Let's also check that the video streaming route exists:
bash   grep -n -A 10 -B 5 "video_feed\|/video" chatty_ai.py
Now try running it:
bashpython3 chatty_ai.py



