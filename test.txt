

The service is failing to start after reboot. This is likely because the service is starting before all dependencies are ready. Let's fix this:

1. Check Service Status

bash   sudo systemctl status chatty-ai.service
sudo journalctl -u chatty-ai.service -n 50

2. Fix Service Dependencies

Update /etc/systemd/system/chatty-ai.service to wait for network to be fully ready:

bash   sudo nano /etc/systemd/system/chatty-ai.service

ini[Unit]
Description=Chatty AI Web Interface
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=nickspi5
Group=nickspi5
SupplementaryGroups=audio
WorkingDirectory=/home/nickspi5/Chatty_AI
Environment=PATH=/home/nickspi5/Chatty_AI/chatty-venv/bin:/usr/bin:/bin
Environment=PULSE_RUNTIME_PATH=/run/user/1000/pulse

# Add startup delay
ExecStartPre=/bin/sleep 10

ExecStart=/home/nickspi5/Chatty_AI/chatty-venv/bin/python /home/nickspi5/Chatty_AI/chatty_ai.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target


3. Enable Network Wait Service
bash   sudo systemctl enable systemd-networkd-wait-online.service

4. Update Startup Script Timing

Edit /home/nickspi5/Chatty_AI/chatty_ai_startup.sh to wait longer for services:


# After video plays, wait for services to be ready
log_message "Waiting for services to start..."
WAITED=0
MAX_WAIT=90  # Increase from 70 to 90 seconds

while [ $WAITED -lt $MAX_WAIT ]; do
    if netstat -tuln | grep -q ":5000 "; then
        log_message "Port 5000 is open and ready"
        sleep 5  # Extra 5 seconds to ensure fully ready
        break
    fi
    sleep 2
    WAITED=$((WAITED + 2))
    
    if [ $WAITED -eq 30 ] || [ $WAITED -eq 60 ]; then
        log_message "Still waiting for port 5000... ($WAITED seconds)"
    fi
done

5. Reload and Test

bash   sudo systemctl daemon-reload
sudo systemctl restart chatty-ai.service

# Check if it's running

sleep 15
netstat -tuln | grep 5000

The issue is timing - the service needs more time to start after boot. The changes above add a delay and better dependency management.

